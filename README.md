### Описание

Онлайн-сервис Foodgram и API для него.Имеется реализация CI/CD проекта.На этом сервисе пользователи могут публиковать рецепты, подписываться на публикации других пользователей, добавлять понравившиеся рецепты в список "Избранное", а перед походом в магазин скачивать сводный список продуктов, необходимых для приготовления одного или нескольких выбранных блюд.

### Доступный функционал

- Аутентификация реализована с помощью стандартного модуля DRF - Authtoken.
- У неаутентифицированных пользователей доступ к API только на уровне чтения.
- Создание объектов разрешено только аутентифицированным пользователям.
- На прочий фунционал наложено ограничение в виде административных ролей и авторства.
- Управление пользователями.
- Возможность получения подробной информации о себе и ее редактирование.
- Возможность подписаться на других пользователей и отписаться от них.
- Получение списка всех тегов и ингредиентов.
- Получение списка всех рецептов, их добавление.Получение, обновление и удаление конкретного рецепта.
- Возможность добавить рецепт в избранное.
- Возможность добавить рецепт в список покупок.
- Возможность скачать список покупок в PDF формате.
- Фильтрация по полям.
#### Документация к API доступна по адресу http://localhost/api/docs/ после локального запуска проекта
**Локальный запуск проекта**

1. Склонировать репозиторий:
``` bash
   git clone <название репозитория>
   cd <название репозитория>
```
2. Cоздать и активировать виртуальное окружение:
*Команда для установки виртуального окружения на Mac или Linux:*
``` bash
   python3 -m venv env
   source env/bin/activate
```
*Команда для Windows:*
``` bash
   python -m venv venv
   source venv/Scripts/activate
```
Перейти в директорию infra:
``` bash
   cd infra
```
Создать файл .env по образцу:
``` bash
   cp .env.example .env
```
Выполнить команду для доступа к документации:
``` bash
   docker-compose up
```
Установить зависимости из файла requirements.txt:
``` bash
   cd ..
   cd backend
   pip install -r requirements.txt
   python manage.py migrate
```
Создать суперпользователя, если необходимо:
``` bash
python manage.py createsuperuser
```
Запустить локальный сервер:
``` bash
   python manage.py runserver
```
#### Установка на удалённом сервере
Выполнить вход на удаленный сервер

Установить docker:
``` bash
   sudo apt install docker.io
```
Установить docker-compose:
``` bash
    sudo apt install docker-compose
```
или воспользоваться официальной инструкцией

Находясь на удаленном сервере пропишите конфигурацию nginx:
``` bash
 sudo nano /etc/nginx/sites-enabled/default
```
 
 **Для правильной работы workflow необходимо добавить в Secrets данного репозитория на GitHub переменные окружения:**
- Переменные PostgreSQL, ключ проекта Django и их значения по-умолчанию можно взять из файла .env.example, затем установить свои.
``` bash
POSTGRES_DB=db_foodgram
POSTGRES_USER=django_user
POSTGRES_PASSWORD=mysecretpassword
DB_NAME=foodgram_db
DB_HOST=foodgram_db
DB_PORT=5432
SECRET_KEY=''
ALLOWED_HOSTS=***.***.**.**,127.0.0.1,localhost,ffoodgram.ddns.net
DEBUG=true

DOCKER_USERNAME=<имя пользователя DockerHub>
DOCKER_PASSWORD=<пароль от DockerHub>

USER=<username для подключения к удаленному серверу>
HOST=<ip сервера>
PASSPHRASE=<пароль для сервера, если он установлен>
SSH_KEY=<ваш приватный SSH-ключ (для получения команда: cat ~/.ssh/id_rsa)>

TELEGRAM_TO=<id вашего Телеграм-аккаунта>
TELEGRAM_TOKEN=<токен вашего бота>
```

### Workflow проекта
- запускается при выполнении команды git push
- tests: проверка кода на соответствие PEP8.
- build_and_push_to_docker_hub: сборка и размещение образа проекта на DockerHub.
- Make envfile: создание и размещение .env - файла из секретов на боевой сервер
- Copy ingredients.json via ssh's scp : копирование файла инредиентов на сервер
- Copy tags.json via ssh's scp: копирование файла гетов на сервер
- Copy docker-compose.production.yml via SSH: копиррование файла docker-compose.production.yml на сервер
- Copy Arial.ttf via SSH: копирование шрифта для отображения списка продуктов в PDF формате
- deploy: автоматический деплой на боевой сервер и запуск проекта, загрузка ингредиентов и тегов в БД

- send_massage: отправка уведомления пользователю в Телеграм.
### После успешного результата работы workflow зайдите на боевой сервер
- Создайте суперпользователя:
``` bash
   sudo docker-compose exec backend python manage.py createsuperuser
```
### Примеры некоторых запросов API
- Регистрация пользователя:

   ```POST /api/v1/users/```
- Получение данных своей учетной записи:

   ```GET /api/v1/users/me/ ```
- Добавление подписки:

   ```POST /api/v1/users/id/subscribe/```
- Обновление рецепта:

   ```PATCH /api/v1/recipes/id/```
- Удаление рецепта из избранного:

   ```DELETE /api/v1/recipes/id/favorite/```
- Получение списка ингредиентов:

   ```GET /api/v1/ingredients/```
Скачать список покупок:

   ```GET /api/v1/recipes/download_shopping_cart/```
### Проект доступен по адресу: https://ffoodgram.ddns.net/
